<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Doctor</title>
    <link rel="stylesheet" href="../css/add_Doctor.css">
    <style>
        .active-step {
            color: green;
            font-weight: bold;
        }
        .completed-step {
            color: gray;
        }
    </style>
</head>
<body>
    <!-- Header and navigation code remains the same -->

    <main>
        <section class="form-section">
            <div class="form-container">
                <ul class="form-steps">
                    <li id="step-1" class="active-step">1. Información básica</li>
                    <li id="step-2">2. Información de contacto</li>
                </ul>
                <div class="form-content">
                    <h2 id="form-title">Información básica</h2>

                    <form id="doctor-form">
                        <!-- Basic Info -->
                        <div id="basic-info-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nombre-completo">Nombre Completo</label>
                                    <input type="text" id="nombre-completo" name="nombre" required>
                                </div>
                                <div class="form-group">
                                    <label for="genero">Género</label>
                                    <select id="genero" name="genero" required>
                                        <option value="">Seleccione el género</option>
                                        <option value="Masculino">Masculino</option>
                                        <option value="Femenino">Femenino</option>
                                        <option value="Otro">Otro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="especialidad">Especialidad</label>
                                    <select id="especialidad" name="especialidad" required>
                                        <option value="">Seleccione la especialidad</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="fecha-nacimiento">Fecha de nacimiento</label>
                                    <input type="date" id="fecha-nacimiento" name="fecha_nacimiento" required>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" id="next-step-btn">Siguiente</button>
                            </div>
                        </div>

                        <!-- Contact Info (initially hidden) -->
                        <div id="contact-info-section" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tipo-contacto">Tipo de Contacto</label>
                                    <select id="tipo-contacto" name="tipo_contacto" required>
                                        <option value="">Seleccione el tipo de contacto</option>
                                        <option value="Celular">Celular</option>
                                        <option value="Telefono">Teléfono</option>
                                        <option value="Correo electronico">Correo electrónico</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="contacto">Contacto</label>
                                    <input type="text" id="contacto" name="contacto" required>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" id="submit-btn">Guardar Doctor</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Variables for DOM elements
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const basicInfoSection = document.getElementById('basic-info-section');
        const contactInfoSection = document.getElementById('contact-info-section');
        const nextStepBtn = document.getElementById('next-step-btn');
        const formTitle = document.getElementById('form-title');
        const doctorForm = document.getElementById('doctor-form');
        const especialidadSelect = document.getElementById('especialidad');

        // Fetch specialties and populate the select
        fetch('http://localhost:3000/especialidad/v1/')
            .then(response => response.json())
            .then(data => {
                if (Array.isArray(data)) {
                    data.forEach(specialty => {
                        const option = document.createElement('option');
                        option.value = specialty.id;
                        option.textContent = specialty.nombre;
                        especialidadSelect.appendChild(option);
                    });
                } else if (data.data && Array.isArray(data.data)) {
                    data.data.forEach(specialty => {
                        const option = document.createElement('option');
                        option.value = specialty.id;
                        option.textContent = specialty.nombre;
                        especialidadSelect.appendChild(option);
                    });
                } else {
                    console.error('Unexpected data format:', data);
                }
            })
            .catch(error => console.error('Error fetching specialties:', error));

        // Handle next step button click
        nextStepBtn.addEventListener('click', function() {
            if (validateBasicInfo()) {
                step1.classList.remove('active-step');
                step1.classList.add('completed-step');
                step2.classList.add('active-step');
                basicInfoSection.style.display = 'none';
                contactInfoSection.style.display = 'block';
                formTitle.textContent = 'Información de contacto';
            }
        });

        // Handle form submission
        doctorForm.addEventListener('submit', function(e) {
            e.preventDefault();
            if (validateContactInfo()) {
                const formData = new FormData(doctorForm);
                const doctorData = {
                    nombre: formData.get('nombre'),
                    genero: formData.get('genero'),
                    especialidad: formData.get('especialidad'),
                    fecha_nacimiento: formData.get('fecha_nacimiento'),
                    estado: 'Activo', // Default state
                    tipo_contacto: formData.get('tipo_contacto'),
                    contacto: formData.get('contacto')
                };

                fetch('http://localhost:3000/doctor/v1/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(doctorData)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Doctor guardado:', data);
                    alert('Doctor guardado exitosamente');
                    doctorForm.reset();
                    // Reset form view to basic info
                    basicInfoSection.style.display = 'block';
                    contactInfoSection.style.display = 'none';
                    step1.classList.add('active-step');
                    step1.classList.remove('completed-step');
                    step2.classList.remove('active-step');
                    formTitle.textContent = 'Información básica';
                })
                .catch(error => {
                    console.error('Error al guardar doctor:', error);
                    alert('Hubo un error al guardar la información del doctor');
                });
            }
        });

        function validateBasicInfo() {
            // Add your validation logic here
            return true; // Return true if validation passes
        }

        function validateContactInfo() {
            // Add your validation logic here
            return true; // Return true if validation passes
        }
    </script>
</body>
</html>